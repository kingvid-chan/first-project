<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
  <script>
    /**
     * MobileWeb 通用功能助手，包含常用的 UA 判断、页面适配、search 参数转 键值对。
     * 该 JS 应在 head 中尽可能早的引入，减少重绘。
     *
     * fixScreen 方法根据两种情况适配，该方法自动执行。
     *      1. 定宽： 对应 meta 标签写法 -- <meta name="viewport" content="target-densitydpi=device-dpi,width=750">
     *          该方法会提取 width 值，主动添加 scale 相关属性值。
     *          注意： 如果 meta 标签中指定了 initial-scale， 该方法将不做处理（即不执行）。
     *      2. REM: 不用写 meta 标签，该方法根据 dpr 自动生成，并在 html 标签中加上 data-dpr 和 font-size 两个属性值。
     *          该方法约束：IOS 系统最大 dpr = 3，其它系统 dpr = 1，页面每 dpr 最大宽度（即页面宽度/dpr） = 750，REM 换算比值为 16。
     *          对应 css 开发，任何弹性尺寸均使用 rem 单位，rem 默认宽度为 视觉稿宽度 / 16;
     *              scss 中 $ppr(pixel per rem) 变量写法 -- $ppr: 750px/16/1rem;
     *                      元素尺寸写法 -- html { font-size: $ppr*1rem; } body { width: 750px/$ppr; }。

     */
    window.mobileUtil = (function(win, doc) {
      var UA = navigator.userAgent,
        isAndroid = /android|adr/gi.test(UA),
        isIos = /iphone|ipod|ipad/gi.test(UA) && !isAndroid, // 据说某些国产机的UA会同时包含 android iphone 字符
        isMobile = isAndroid || isIos;  // 粗略的判断

      return {
        isAndroid: isAndroid,
        isIos: isIos,
        isMobile: isMobile,

        isNewsApp: /NewsApp\/[\d\.]+/gi.test(UA),
        isWeixin: /MicroMessenger/gi.test(UA),
        isQQ: /QQ\/\d/gi.test(UA),
        isYixin: /YiXin/gi.test(UA),
        isWeibo: /Weibo/gi.test(UA),
        isTXWeibo: /T(?:X|encent)MicroBlog/gi.test(UA),

        tapEvent: isMobile ? 'tap' : 'click',

        /**
         * 缩放页面
         */
        fixScreen: function() {
          var metaEl = doc.querySelector('meta[name="viewport"]'),
            metaCtt = metaEl ? metaEl.content : '',
            matchScale = metaCtt.match(/initial\-scale=([\d\.]+)/),
            matchWidth = metaCtt.match(/width=([^,\s]+)/);

          if ( !metaEl ) { // REM
            var docEl = doc.documentElement,
              maxwidth = docEl.dataset.mw || 750, // 每 dpr 最大页面宽度
              dpr = isIos ? Math.min(win.devicePixelRatio, 3) : 1,
              scale = 1 / dpr,
              tid;

            docEl.removeAttribute('data-mw');
            docEl.dataset.dpr = dpr;
            metaEl = doc.createElement('meta');
            metaEl.name = 'viewport';
            metaEl.content = fillScale(scale);
            docEl.firstElementChild.appendChild(metaEl);

            var refreshRem = function() {
              var width = docEl.getBoundingClientRect().width;
              console.log('111',width);
              if (width / dpr > maxwidth) {
                width = maxwidth * dpr;
              }
              var rem = width / 16;
              docEl.style.fontSize = rem + 'px';
              if(window.location.href.indexOf('/visualediting/visualEditing.html?veBean.pageInstanceId')>-1){
                docEl.style.fontSize = '20px';
              }
            };

            win.addEventListener('resize', function() {
              clearTimeout(tid);
              tid = setTimeout(refreshRem, 300);
            }, false);
            win.addEventListener('pageshow', function(e) {
              if (e.persisted) {
                clearTimeout(tid);
                tid = setTimeout(refreshRem, 300);
              }
            }, false);

            refreshRem();
          } else if ( isMobile && !matchScale && ( matchWidth && matchWidth[1] != 'device-width' ) ) { // 定宽
            var	width = parseInt(matchWidth[1]),
              iw = win.innerWidth || width,
              ow = win.outerWidth || iw,
              sw = win.screen.width || iw,
              saw = win.screen.availWidth || iw,
              ih = win.innerHeight || width,
              oh = win.outerHeight || ih,
              ish = win.screen.height || ih,
              sah = win.screen.availHeight || ih,
              w = Math.min(iw,ow,sw,saw,ih,oh,ish,sah),
              scale = w / width;

            if ( scale < 1 ) {
              metaEl.content = metaCtt + ',' + fillScale(scale);
            }
          }

          function fillScale(scale) {
            return 'initial-scale=' + scale + ',maximum-scale=' + scale + ',minimum-scale=' + scale;
          }
        },

        /**
         * 转href参数成键值对
         * @param href {string} 指定的href，默认为当前页href
         * @returns {object} 键值对
         */
        getSearch: function(href) {
          href = href || win.location.search;
          var data = {},reg = new RegExp( "([^?=&]+)(=([^&]*))?", "g" );
          href && href.replace(reg,function( $0, $1, $2, $3 ){
            data[ $1 ] = $3;
          });
          return data;
        }
      };
    })(window, document);

    // 默认直接适配页面
    mobileUtil.fixScreen();
  </script>
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <title>Geek Gift</title>
  <link rel="stylesheet" href="geek_gift.css"/>
</head>

<body>
<div class="wrapper">
<header class="banner">
    <img src="http://img10.360buyimg.com/cms/jfs/t2074/154/2149212560/50423/789561b9/569e0151N622b2ac1.jpg" width="100%">
</header>

<!-- 海景房-->
<section class="goodsList-block goods-list-1" id="flr1">
    <div class="floor-title">
        <h2 class="flr-hd-1 flr-hd"><img src="http://img12.360buyimg.com/cms/jfs/t1981/193/2054765405/5526/305197d1/569e0152Na041866c.jpg" alt="" width="100%"/></h2>
    </div>
    <ul id="list1" class="goods-list seaHouse-list" marketstart="0" markettplid="list1Tpl1" marketurl="http://acen.jd.com/tjw/get/tjw2015/tjw15698cf09acae8.js" marketonload="xmlLoad(1);">
    </ul>
</section>
<!-- 海景房-->
<!-- 常规商品楼层-->
<section class="goodsList-block goods-list-2" id="flr2">
    <div class="floor-title">
        <h2 class="flr-hd-2 flr-hd"><img src="http://img14.360buyimg.com/cms/jfs/t2578/6/1290465003/5428/e8a917bb/569e0152N2d90313a.jpg" alt="" width="100%"/></h2>
    </div>
    <ul id="list2" class="goods-list" marketstart="0" markettplid="list1Tpl2" marketurl="http://acen.jd.com/tjw/get/tjw2015/tjw15698cf4fe2c30.js" marketonload="xmlLoad(1);">
    </ul>
</section>
<!-- 海景房-->
<script type="text/html" id="list1Tpl1">
    <li class="seaHouse-list-inner">
        <a class="goods-link" href="http://m.jd.ru/ware/detail/{#id#}" hasclstag="true" spuid="{#id#}">
            <span class="qw_border"></span>
            <div class="j-pic">
                <img src="{#image#}" width="100%">
                <span class="discount"><span class="num">-{#appPrice#}</span></span>
            </div>
            <div class="details">
                <p class="title">{#recommendName#}</p>
                <p class="selling-point">
                  <span>{#defined1#}</span>
                  <span>{#defined2#}</span>
                  <span>{#defined3#}</span>
                </p>
                <p class="price">
                    <span class="j-jd-price">USD ${#jdPrice#}</span>
                    <span class="j-sku-price"><del>USD ${#normalPrice#}</del></span>
                </p>
                <span class="j-heart-icon"></span>
                <p class="btn-buy"><img src="http://img13.360buyimg.com/cms/jfs/t2065/9/2124527435/2540/70c38935/569e0151N32ada9cd.jpg"></p>
            </div>
        </a>
    </li>
</script>
<!--end of 海景房-->
<!-- 常规商品楼层模板-->
<script type="text/html" id="list1Tpl2">
    <li>
        <a class="goods-link" href="http://m.jd.ru/ware/detail/{#id#}" hasclstag="true" spuid="{#id#}">
            <div class="j-pic">
                <img src="{#image#}" width="100%">
                <span class="discount"><span class="num">-{#appPrice#}</span></span>
            </div>
            <div class="details">
                <p class="title">{#recommendName#}</p>
                <p class="price">
                    <span class="j-jd-price">${#jdPrice#}</span>
                    <span class="j-sku-price"><del>${#normalPrice#}</del></span>
                </p>
                <p class="btn-buy"><img src="http://img13.360buyimg.com/cms/jfs/t1933/187/2049227848/2575/a8a0c72a/569e0151Nc81838ba.jpg"></p>
            </div>
        </a>
    </li>
</script>
<!--end of 常规商品楼层模板-->



<!--end of GTM 埋点  *还有一小段在xiaomi.js中*-->
<script type="text/javascript">
    if(window.google_tag_params){
        dataLayer = [{
            'google_tag_params': window.google_tag_params
        }];
    }
</script>
<!-- Google Tag Manager -->
<noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-WFSLVN"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!--end of GTM 埋点-->

<script src="http://acen.jd.com/h5/topActivity/media/js/lib/zepto-1.1.6.min.js"></script>
<script src="http://acsten.jd.com/static/market-1.0.0.min.js"></script>
<!--<script src="../media/js/new_year.js"></script>-->
<script>
    $(function(){
        //激活ios active状态
        document.addEventListener("touchstart", function() {},false);


        /* xmlLoad */
        window.xmlObj = {
            total: $('[marketurl]').length,
            loadedNo:0
        }
        window.xmlLoad = function(_flag){
            if(_flag == 1){
                xmlObj.loadedNo ++;
            }
            if(xmlObj.loadedNo == xmlObj.total){
                marketRendered();
            }
        }
    })


    /* 数据源加载完毕执行的code */
    function marketRendered(){
        //链接地址拼接埋点
        $.each($('[hasclstag]'), function (index,item){
            var spuId = $(item).attr('spuid');
            $(item).attr({
                "clstag": "pageclick|keycount|2016Jan_h5_geekgift_2016011912|"+(index+1)
            })
        })
        //arrival判断
        $.each($('.arrival,.jd-collection,.interest-point'), function (index,item){
            if($.trim($(item).text())=='【】' || $.trim($(item).text())=='【 】'){
                $(item).css('opacity', '0');
            }
        })
        //tab当前态
        $.each($('.tab-list li'), function (index,item){
            $(item).click(function(){
                $(item).addClass('active')
                        .siblings().removeClass('active');
                $('.tab-ctn').scrollLeft(0);
            })
        })
        //优惠券吸顶

    }
</script>


<!--start of JA埋点-->
<script type="text/javascript">
    var jap = {
        siteId : 'JA2015_161293',
        topic: 'traffic-hw',
        account : '',
        skuid: '',
        shopid: '',
        orderid: '',
        adsCookieName: '',
        __cookie_jda: '__tra',
        __cookie_jdb: '__trb',
        __cookie_jdc: '__trc',
        __cookie_jdu: '__tru',
        __cookie_jdv: '__trv'
    };
    (function() { var ja = document.createElement('script'); ja.type = 'text/javascript'; ja.async = true;
        ja.src=('https:'==document.location.protocol?'https://miscssl':'http://misc')+ '.360buyimg.com/jdf/1.0.0/unit/ja/1.0.0/ja.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ja,s);
    })();
</script>
<!--end of JA埋点-->

<!--start of GTM 埋点 -->
<script type="text/javascript">
    if(window.google_tag_params){
        dataLayer = [{
            'google_tag_params': window.google_tag_params
        }];
    }
</script>
<noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-WFSLVN"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!--
<script>
    $(function(){
        /*GTM埋点*/
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-WFSLVN');
    });
</script>
-->
<script src="touch.js"></script>
<script src="geek_gift.js"></script>
<!--end of GTM 埋点-->
</body>
</html>
