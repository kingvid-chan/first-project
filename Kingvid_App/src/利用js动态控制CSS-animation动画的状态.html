<html>
<head>
  <title>利用js动态控制CSS-animation动画的状态</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/276742; Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="372"/>
<h1>利用js动态控制CSS-animation动画的状态</h1>

<div>
<span><div><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">①一般我们写css3 animation动画的时候都是把它们定死在某个值不能改变，其实在js中是有相应的对象可以达到动态控制keyframes关键帧的目的</p><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">举个例子：<br/><br/></p><div style="margin: 0px; padding: 10px; border: 1px solid rgb(232, 232, 232); font-size: 12px; color: rgb(102, 102, 102); text-align: center; font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; width: 168px; background: rgb(250, 250, 250);"><a href="http://wiki.weisai.net/uploads/201508/14402245143mTiZnQ3.png" style="color: rgb(2, 104, 205); text-decoration: none;" target="_blank" title="表盘效果"><img src="利用js动态控制CSS-animation动画的状态_files/Image.png" type="image/png" alt="表盘效果" style="cursor: default; height: auto;" title="表盘效果"/></a><strong style="font-size: 12px; font-weight: normal; display: block; overflow: hidden; padding-top: 10px; clear: both;">表盘效果</strong></div><br style="color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><span style="color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">在消渴丸中定义的表盘效果，客户需要指针每个月根据数值做出动态变化</span><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></p><pre style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
&lt;div class=&quot;page page7&quot;&gt;
    &lt;h4 class=&quot;element p7-1&quot;&gt;销售费用&lt;/h4&gt;
    &lt;p  class=&quot;hidden-text p7-deg&quot;&gt;100&lt;/p&gt;<span style="background-color: rgb(192, 192, 192);">&lt;!--指针角度 -133~133 --&gt;</span>
    &lt;div class=&quot;clock&quot;&gt;
         &lt;div&gt;
                &lt;img src=&quot;images/clock1.png&quot; class=&quot;p7-2&quot;&gt;
                &lt;img src=&quot;images/clock-p.png&quot; class=&quot;p7-3 animated&quot;&gt;
                &lt;p class=&quot;element p7-4 animated&quot;&gt;累计销售费用：10000万元&lt;/p&gt;
                &lt;p class=&quot;element p7-5 animated&quot;&gt;销售费用率：100%&lt;/p&gt;
         &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
</pre><pre style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br/></pre><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font color="#0000FF">.p7-deg这个隐藏标签就是用于接收后台设定的最终旋转角度</font></p><pre style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
function clockfunction(page,rule){
        var rotateDeg=parseInt($('.p'+page+'-deg').text());
        var end=&quot;100% {-webkit-transform:rotate(&quot;+rotateDeg+&quot;deg);opacity:1;}&quot;;
        var key=document.styleSheets[3].cssRules[rule];
        key.deleteRule(&quot;100%&quot;);
        key.insertRule(end);
}
</pre><pre style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
...
</pre><pre style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
clockfunction(7,0);
</pre><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font color="#0000FF">document.styleSheets[3].cssRules[0] </font>表示获取html中第4个样式表中的第一条规则</p><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">值得注意的是<font color="#FF0000">webkit浏览器</font>是不能使用这条语句来获取外链样式表的css规则（亲测出来的）</p><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">如果要想用js控制keyframes的关键帧，就需要将-webkit-keyframes放到&lt;style&gt;标签中来获取：</p><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br/><br/></p><div style="margin: 0px; padding: 10px; border: 1px solid rgb(232, 232, 232); font-size: 12px; color: rgb(102, 102, 102); text-align: center; font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; width: 300px; background: rgb(250, 250, 250);"><a href="http://wiki.weisai.net/uploads/201508/1440225975POifpV1N.png" style="color: rgb(2, 104, 205); text-decoration: none;" target="_blank" title="style"><img src="利用js动态控制CSS-animation动画的状态_files/Image [1].png" type="image/png" alt="style" style="cursor: default; height: auto;" title="style"/></a><strong style="font-size: 12px; font-weight: normal; display: block; overflow: hidden; padding-top: 10px; clear: both;">style</strong></div><br style="color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><span style="color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">而在这个表盘效果的例子中，是通过clock1这个keyframes来控制的（微信专题中只需处理webkit前缀，想要兼容性更全面自行添加其他前缀）</span><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></p><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">而<span style="color: rgb(0, 0, 255);">document.styleSheets[3].cssRules[0]</span>就是获取clock1这个对象了</p><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">它是一个<span style="font-family: &apos;Helvetica Neue&apos;, Helvetica, Tahoma, Arial, STXihei, &apos;Microsoft YaHei&apos;, 微软雅黑, sans-serif; font-size: 16px; text-indent: 16px; background-color: rgb(254, 254, 254);">WebkitCSSKeyFramesRule对象，</span><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Tahoma, Arial, STXihei, &apos;Microsoft YaHei&apos;, 微软雅黑, sans-serif; font-size: 16px; text-indent: 16px; background-color: rgb(254, 254, 254);">有三个接口，deleteRule, insertRule, findRule</span></p><pre style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
WebkitCSSKeyFramesRule.deleteRule(&quot;50%&quot;);
WebkitCSSKeyFramesRule.findRule(&quot;50%&quot;);
WebkitCSSKeyFramesRule.insertRule(&quot;50%&quot;, &quot;{left: 0px}&quot;);
</pre><pre style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br/></pre><p style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(51, 51, 51); font-family: &apos;Helvetica Neue&apos;, Helvetica, Tahoma, Arial, STXihei, &apos;Microsoft YaHei&apos;, 微软雅黑, sans-serif; font-size: 16px; text-indent: 16px; background-color: rgb(254, 254, 254);">我的处理方式就是通过获取.p7-deg中的值来动态设置指针</span><span style="font-family: &apos;Helvetica Neue&apos;, Helvetica, Tahoma, Arial, STXihei, &apos;Microsoft YaHei&apos;, 微软雅黑, sans-serif; font-size: 16px; text-indent: 16px; background-color: rgb(254, 254, 254);">最终旋转角度</span></p><div style="margin: 0px 0px 10px; padding: 0px; color: rgb(0, 0, 0); font-family: verdana, SimSun, Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 14px;"><div><font size="3">另外，与animation相关的还有<span style="color: rgb(51, 51, 51); font-family: &apos;Microsoft Yahei&apos;; orphans: 2; widows: 2;">animationEnd,animationStart和animationIteration这三个事件，</span><span style="color: rgb(51, 51, 51); font-family: &apos;Microsoft Yahei&apos;; orphans: 2; widows: 2;">分别是在元素的动画结束时，开始时，或者完成一次迭代时触发，通过监听这些事件，可以做出更多动画变化，有待后续的发现咯</span></font></div></div></div></span>
</div></body></html> 